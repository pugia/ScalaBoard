<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<title>ScalaBoard</title>
		<link rel="stylesheet" href="/css/main.css">
	</head>

	<body>
		
		<header>
			<form action="/profile" class="dropzone" id="drop">
			  <div class="fallback">
			    <input name="file" type="file" multiple />
			  </div>
			</form>
		</header>
		
		<section id="board">
						
		</section>
		
		
		<script src="//cdnjs.cloudflare.com/ajax/libs/draggabilly/1.2.0/draggabilly.pkgd.min.js"></script>
		<script src="/bower_components/d3/d3.min.js"></script>
		<script src="/bower_components/dropzone/dist/min/dropzone.min.js"></script>
		<script>
			Dropzone.autoDiscover = false;

			var draggies = []
	
			var board = d3.select('#board');
			
			var myDropzone = new Dropzone("#drop", { 
				url: "/profile",
				success: function(e, response) {

					if (response.filename.indexOf('@2x') != -1) {
						response.data.width = response.data.width / 2;
						response.data.height = response.data.height / 2;
					}
					
					var element =  board.append('div')
															.classed('element', true)
															.style('background-image', 'url(/upload/'+ response.filename +')')
															.style('width', response.data.width + 'px')
															.style('height', response.data.height + 'px')
															
				  var draggie = new Draggabilly( element[0][0], {
				    grid: [ 10, 10 ],
				    containment: '#board'
				  });
				  draggies.push( draggie );
					
				},
				complete: function(e) {
					this.removeFile(e);
				}
			});
			
			var draggableElems = document.querySelectorAll('div.element');
			// init Draggabillies
			for ( var i=0, len = draggableElems.length; i < len; i++ ) {
			  var draggableElem = draggableElems[i];
			  var draggie = new Draggabilly( draggableElem, {
			    grid: [ 10, 10 ],
			    containment: '#board'
			  });
			  draggies.push( draggie );
			}			
			
		</script>


	</body>
</html>	